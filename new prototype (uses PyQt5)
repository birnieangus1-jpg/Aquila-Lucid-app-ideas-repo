# Language: Python 3
import sys
from PyQt5.QtWidgets import QApplication, QWidget, QVBoxLayout, QLineEdit, QPushButton, QTextEdit, QScrollArea, QLabel, QFrame
from PyQt5.QtCore import Qt
from PyQt5.QtGui import QColor, QPainter, QBrush, QFont, QPalette

# Custom QLabel for chat bubble
class BubbleLabel(QLabel):
    def __init__(self, text, is_sender=True, parent=None):
        super().__init__(text, parent)
        self.is_sender = is_sender
        self.setWordWrap(True)
        self.setMargin(10)
        self.setMinimumWidth(100)
        self.setMaximumWidth(300)
        self.setStyleSheet(self.get_style())
        
    def get_style(self):
        if self.is_sender:
            # Sender bubble style
            return """
            QLabel {
                background-color: #4CAF50;
                color: white;
                border-radius: 15px;
                padding: 10px;
            }
            """
        else:
            # Receiver bubble style
            return """
            QLabel {
                background-color: #E0E0E0;
                color: black;
                border-radius: 15px;
                padding: 10px;
            }
            """

# Main application window
class ChatWindow(QWidget):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("PyQt5 Chat Bubble Example")
        self.setGeometry(100, 100, 400, 500)

        self.layout = QVBoxLayout()

        # Chat display area inside scroll area
        self.scroll = QScrollArea()
        self.scroll.setWidgetResizable(True)
        self.content_widget = QWidget()
        self.scroll_layout = QVBoxLayout(self.content_widget)
        self.scroll_layout.setAlignment(Qt.AlignTop)
        self.scroll.setWidget(self.content_widget)

        # Input field and send button
        self.input_field = QLineEdit()
        self.input_field.setPlaceholderText("Type your message...")
        self.send_button = QPushButton("Send")
        self.send_button.clicked.connect(self.send_message)

        self.layout.addWidget(self.scroll)
        self.layout.addWidget(self.input_field)
        self.layout.addWidget(self.send_button)
        self.setLayout(self.layout)

    def send_message(self):
        text = self.input_field.text().strip()
        if text:
            # Add sender bubble
            bubble = BubbleLabel(text, is_sender=True)
            self.scroll_layout.addWidget(bubble, alignment=Qt.AlignRight)
            
            # Optionally simulate a reply bubble
            reply = BubbleLabel(f"Echo: {text}", is_sender=False)
            self.scroll_layout.addWidget(reply, alignment=Qt.AlignLeft)
            
            # Clear input field
            self.input_field.clear()
            
            # Scroll to the bottom
            self.scroll.verticalScrollBar().setValue(self.scroll.verticalScrollBar().maximum())

if __name__ == "__main__":
    app = QApplication(sys.argv)
    window = ChatWindow()
    window.show()
    sys.exit(app.exec_())
